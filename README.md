# TeleScope — мониторинг Telegram

Дашборд для отслеживания упоминаний ключевых слов в Telegram-чатах в реальном времени. Регистрация и вход по email, разделение данных по пользователям, админ-панель для управления каналами и учётными записями.

## Стек

- **Backend:** FastAPI, SQLAlchemy, PostgreSQL, JWT, Telethon (сканер Telegram)
- **Frontend:** Next.js 16, React 19, Tailwind CSS

## Требования

- Python 3.11+
- Node.js 18+ (pnpm)
- PostgreSQL

## Настройка

### 1. Клонирование и зависимости

```bash
# Backend
pip install -r requirements.txt

# Frontend
pnpm install
```

### 2. Переменные окружения

Скопируйте `.env.example` в `.env` и заполните:

```bash
cp .env.example .env
```

**Обязательно:**

| Переменная      | Описание |
|-----------------|----------|
| `DATABASE_URL`  | Подключение к PostgreSQL, например: `postgresql+psycopg2://user:pass@localhost:5432/telegram_monitor` |
| `JWT_SECRET`    | Секрет для JWT (в проде обязательно сменить) |
| `TG_API_ID`     | API ID приложения с my.telegram.org |
| `TG_API_HASH`   | API Hash приложения |

**Опционально (бэкенд):**

- `AUTO_START_SCANNER=1` — запускать сканер Telegram вместе с API
- `TG_USER_ID` — id пользователя в БД, чьи ключевые слова и чаты сканировать (по умолчанию 1)
- `TG_SESSION_STRING` или `TG_SESSION_NAME` — сессия Telethon (для работы без интерактивного входа)
- `TG_CHATS` — список чатов через запятую; если пусто — берутся из таблицы `chats`
- `TG_PROXY_*` — SOCKS5-прокси при необходимости

**Опционально (фронт):**

- `NEXT_PUBLIC_API_URL` — URL бэкенда. В разработке: `http://localhost:8000`. В проде при прокси через Nginx можно оставить пустым.

### 3. База данных

Создайте БД и при необходимости таблицы:

```bash
# Таблицы создаются при первом запуске API (init_db).
# Для пересоздания схемы (осторожно, данные удалятся):
python recreate_tables.py
```

### 4. Запуск

**Backend (из корня проекта):**

```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

**Frontend:**

```bash
pnpm dev
```

Откройте [http://localhost:3000](http://localhost:3000). Регистрация и вход — на `/auth`, после входа — дашборд на `/dashboard`. Админ-панель — `/admin` (доступна только пользователям с правами администратора).

## Основные сценарии

- **Регистрация** — первый зарегистрированный пользователь получает права администратора.
- **Вход** — JWT сохраняется в localStorage, все запросы к API и WebSocket идут с токеном.
- **Дашборд** — ключевые слова, лента упоминаний в реальном времени (WebSocket). Без входа дашборд перенаправляет на `/auth`.
- **Админка** — каналы, группы каналов, учётные записи. При создании пользователя можно задать пароль (мин. 8 символов).

## Лицензия

Частный проект.

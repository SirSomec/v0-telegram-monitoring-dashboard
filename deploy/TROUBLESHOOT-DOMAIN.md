# Доступ по домену не работает — пошаговая проверка

Выполняйте команды **на сервере** (где запущены Docker и Nginx). Подставьте свой домен вместо `ваш-домен.com`.

## 1. Фронт отвечает на порту 3000

```bash
curl -s -o /dev/null -w "%{http_code}" http://127.0.0.1:3000/
```

**Ожидается:** `200` или `307`.  
**Если не 200/307:** контейнер фронта не запущен или порт не проброшен. Проверьте:

```bash
docker ps | grep frontend
docker compose ps
```

Перезапустите: `docker compose up -d frontend`.

---

## 2. Nginx слушает порт 80

```bash
sudo ss -tlnp | grep ':80 '
# или
sudo netstat -tlnp | grep ':80 '
```

**Ожидается:** строка с `nginx`.  
**Если пусто:** Nginx не установлен или не запущен:

```bash
sudo systemctl status nginx
sudo systemctl start nginx
```

---

## 3. Конфиг Nginx подключён и без ошибок

```bash
sudo nginx -t
ls -la /etc/nginx/sites-enabled/
```

**Ожидается:** `syntax is ok`, `test is successful`, в `sites-enabled` есть симлинк на ваш конфиг.  
**Если ошибка в nginx -t:** исправьте конфиг по тексту ошибки.  
**Если конфига нет в sites-enabled:**  
`sudo ln -sf /etc/nginx/sites-available/telegram-monitor /etc/nginx/sites-enabled/`  
и снова `sudo nginx -t && sudo systemctl reload nginx`.

---

## 4. Nginx отдаёт фронт по порту 80 (локально)

```bash
curl -s -o /dev/null -w "%{http_code}" -H "Host: ваш-домен.com" http://127.0.0.1:80/
```

**Ожидается:** `200` или `307`.  
**Если 404/502:** в конфиге не тот `server_name` или Nginx не проксирует на 3000. Проверьте:

- В конфиге есть `server_name ваш-домен.com _;` (или ваш домен без лишних пробелов).
- В `location /` указано `proxy_pass http://127.0.0.1:3000;` (без слэша в конце).
- После правок: `sudo nginx -t && sudo systemctl reload nginx`.

---

## 5. Домен указывает на сервер

```bash
dig +short ваш-домен.com
# или
nslookup ваш-домен.com
```

**Ожидается:** IP вашего сервера.  
**Если другой IP или пусто:** поправьте A-запись домена в панели регистратора.

---

## 6. Фаервол не режет порт 80

На сервере:

```bash
sudo iptables -L INPUT -n | head -20
# или на облаке: проверить Security Group / правила файрвола для входящего TCP 80
```

**Ожидается:** порт 80 разрешён (для Nginx). Если 80 закрыт — откройте в настройках фаервола/облака.

---

## 7. Фронт собран без жёсткого URL API

Если при сборке был задан `NEXT_PUBLIC_API_URL=http://IP:8000`, с домена страница может открываться, но запросы уйдут на IP и сломаются.

**Проверка:** в `.env` на сервере не должно быть строки `NEXT_PUBLIC_API_URL` или она должна быть пустой:

```bash
grep NEXT_PUBLIC_API_URL .env
```

**Если там что-то вроде `http://...:8000`:** закомментируйте или удалите строку, затем пересоберите фронт:

```bash
docker compose up -d --build frontend
```

Очистите кэш браузера или откройте сайт в режиме инкогнито.

---

## Краткий чеклист

| Шаг | Команда | Ожидание |
|-----|---------|----------|
| Фронт на 3000 | `curl -s -o /dev/null -w "%{http_code}" http://127.0.0.1:3000/` | 200 или 307 |
| Nginx на 80 | `sudo ss -tlnp \| grep ':80 '` | nginx в списке |
| Конфиг | `sudo nginx -t` | syntax ok |
| Прокси по домену | `curl -s -o /dev/null -w "%{http_code}" -H "Host: ваш-домен.com" http://127.0.0.1/` | 200 или 307 |
| DNS | `dig +short ваш-домен.com` | IP сервера |
| API URL | в `.env` пусто или нет `NEXT_PUBLIC_API_URL` | пересборка фронта после правки |

Если все шаги проходят, а в браузере по домену всё равно не открывается — пришлите вывод этих команд (можно без полного конфига), тогда можно сузить причину.
